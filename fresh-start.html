<!DOCTYPE html>
<html>
<head>
    <title>Fresh Start - Clear All Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f0f2f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        button { padding: 15px 25px; margin: 10px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: 600; }
        button.success { background: #28a745; }
        button.primary { background: #007bff; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0; color: #856404; }
        .success-msg { background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 5px; margin: 20px 0; color: #155724; }
        .step { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üÜï Fresh Start - GENESIS</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è Warning</h3>
            <p>This will completely clear all stored data including:</p>
            <ul>
                <li>All usernames and profiles</li>
                <li>Wallet sessions</li>
                <li>Any saved settings</li>
            </ul>
            <p><strong>This cannot be undone!</strong></p>
        </div>

        <div class="step">
            <h3>Step 1: Clear All Data</h3>
            <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            <div id="clearResult"></div>
        </div>

        <div class="step">
            <h3>Step 2: Connect Wallet & Create "Jordan"</h3>
            <button onclick="connectAndCreateJordan()" class="success">üöÄ Connect Wallet & Create Jordan</button>
            <div id="createResult"></div>
        </div>

        <div class="step">
            <h3>Step 3: Test Everything</h3>
            <button onclick="openMainApp()" class="primary">üì± Open Main App</button>
            <button onclick="openTipTest()" class="primary">üí∞ Open Tip Test</button>
        </div>

        <div id="status"></div>
    </div>

    <script src="js/simple-wallet-connection.js"></script>
    
    <script>
        function addResult(containerId, message, isSuccess = false) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = isSuccess ? 'success-msg' : 'warning';
            div.innerHTML = message;
            container.appendChild(div);
        }

        function clearAllData() {
            try {
                // Clear all localStorage
                localStorage.clear();
                
                // Also clear sessionStorage just in case
                sessionStorage.clear();
                
                addResult('clearResult', '‚úÖ All data cleared successfully!<br>Your browser storage is now completely empty.', true);
                
                // Reset status
                document.getElementById('createResult').innerHTML = '';
                document.getElementById('status').innerHTML = '';
                
            } catch (error) {
                addResult('clearResult', '‚ùå Error clearing data: ' + error.message);
            }
        }

        async function connectAndCreateJordan() {
            try {
                addResult('createResult', 'üîÑ Connecting wallet...', false);
                
                // Connect wallet
                const connectResult = await window.genesisWallet.connect();
                if (!connectResult.success) {
                    throw new Error('Wallet connection failed: ' + connectResult.error);
                }
                
                // Authenticate
                const authResult = await window.genesisWallet.authenticate();
                if (!authResult.success) {
                    throw new Error('Authentication failed: ' + authResult.error);
                }
                
                const walletAddress = window.genesisWallet.account;
                
                // Create fresh Jordan profile
                const users = {
                    'jordan': {
                        username: 'jordan',
                        walletAddress: walletAddress.toLowerCase(),
                        displayName: 'Jordan',
                        bio: 'Creator on GENESIS',
                        createdAt: new Date().toISOString(),
                        verified: true,
                        email: null,
                        avatar: null
                    }
                };
                
                // Save to localStorage
                localStorage.setItem('siwe_users', JSON.stringify(users));
                
                // Update wallet session with username
                const session = {
                    account: walletAddress,
                    chainId: window.genesisWallet.chainId,
                    signature: authResult.signature,
                    authenticatedAt: new Date().toISOString(),
                    username: 'jordan',
                    displayName: 'Jordan'
                };
                
                localStorage.setItem('genesis_wallet_session', JSON.stringify(session));
                
                // Force wallet to recognize the username
                window.genesisWallet.checkUsernameAssociation();
                window.genesisWallet.updateWalletUI();
                
                addResult('createResult', 
                    `‚úÖ Success! Created fresh "Jordan" profile!<br>
                    üìã Wallet: ${window.genesisWallet.getShortAddress()}<br>
                    üë§ Username: jordan<br>
                    üéØ Display Name: ${window.genesisWallet.getDisplayName()}<br>
                    üåê Network: ${window.genesisWallet.getNetworkName()}`, true);
                
                // Show current data
                showCurrentData();
                
            } catch (error) {
                addResult('createResult', '‚ùå Error: ' + error.message);
            }
        }

        function showCurrentData() {
            const users = JSON.parse(localStorage.getItem('siwe_users') || '{}');
            const session = JSON.parse(localStorage.getItem('genesis_wallet_session') || '{}');
            
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `
                <div class="success-msg">
                    <h4>üìä Current Data:</h4>
                    <pre>${JSON.stringify(users, null, 2)}</pre>
                    <h4>üíæ Session:</h4>
                    <pre>${JSON.stringify(session, null, 2)}</pre>
                </div>
            `;
        }

        function openMainApp() {
            window.open('/index.html', '_blank');
        }

        function openTipTest() {
            window.open('/test-tip.html', '_blank');
        }

        // Auto-show current data on load
        window.addEventListener('load', () => {
            const users = localStorage.getItem('siwe_users');
            if (users) {
                showCurrentData();
            }
        });
    </script>
</body>
</html>